# Merge Image — 影像對位與合併

本模組示範如何將兩張影像進行**對位（alignment）**與**合併（stitching）**。  
特別強調：**除了「關鍵點偵測」使用現成演算法（如 ORB/SIFT）外，其餘皆為手刻實作**。


---

## 功能重點（除了關鍵點偵測外，全部手刻）

1. **讀檔與前處理**
   - 載入兩張輸入影像（支援彩色）。
   - 視需要轉灰階以便特徵運算。

2. **關鍵點偵測（使用現成演算法）**
   - 例如 ORB / SIFT / AKAZE 取關鍵點與描述子。
   - 輸出：`keypointsA, descA` 與 `keypointsB, descB`。

3. **特徵比對（手刻）**
   - **暴力比對 (Brute Force Matching)**：計算兩組描述子之間的 **Hamming Distance**。
   - **Ratio Test**：手動實作 Lowe's Ratio Test (係數 0.75)，保留最佳與次佳匹配差異夠大的特徵點，剔除模糊匹配。

4. **Homography 估計（手刻 DLT + RANSAC 思路）**
   - **DLT 演算法**：利用最小二乘法 (Least Squares) 解線性方程組，計算 3x3 透視變換矩陣。
   - **RANSAC (隨機抽樣一致性)**：多次隨機抽樣 4 組匹配點，計算出擁有最多內點（Inliers）的最佳矩陣，有效排除錯誤匹配造成的干擾。

5. **影像幾何校正與反向映射（手刻）**
   - **反向映射 (Inverse Mapping)**：將目標影像座標回推至原始影像座標。
   - **雙線性插值 (Bilinear Interpolation)**：手動計算浮點數座標周圍 4 個像素的加權平均，確保變形後的影像平滑無鋸齒。

6. **融合（手刻權重/羽化）**
   - 計算重疊區域的 Alpha Mask。
   - 依據重疊寬度進行線性權重混合，平滑兩張影像的接縫處。

7. **裁切（手刻，可選）**
   - 偵測非空區域邊界，自動輸出乾淨拼接圖。

---

## 範例輸出過程（可放進 README 展示）

| 步驟 | 說明 | 範例圖 |
|------|------|--------|
| 1 | **找出所有關鍵點**：以 ORB/SIFT 偵測影像特徵點，顯示每張影像上的特徵分布。 | ![step1](./Matched%20Image1_2.png) |
| 2 | **保留 4 組主要對應點進行 Homography 運算**：手刻使用 DLT 方法求得轉換矩陣。 | ![step2](./matrix%20points1_2.png) |
| 3️ | **雙線性插值合併影像**：根據 Homography 將右圖反向映射並用雙線性插值填補像素。 | ![step3](./interpolation1_2.png) |
| 4️ | **刪除重疊後輸出最終結果**：清除黑邊區域並輸出完整拼接影像。 | ![step4](./delete_border_warp1_2.png) |

---


