# Merge Image — 影像對位與合併（關鍵點偵測以外全手刻）

本模組示範如何將兩張影像進行**對位（alignment）**與**合併（stitching）**。  
特別強調：**除了「關鍵點偵測」使用現成演算法（如 ORB/SIFT）外，其餘皆為手刻實作**。


---

## 功能重點（除了關鍵點偵測外，全部手刻）

1. **讀檔與前處理**
   - 載入兩張輸入影像（支援彩色）。
   - 視需要轉灰階以便特徵運算。

2. **關鍵點偵測（使用現成演算法）**
   - 例如 ORB / SIFT / AKAZE 取關鍵點與描述子。
   - 輸出：`keypointsA, descA` 與 `keypointsB, descB`。

3. **特徵比對（手刻）**
   - 以 **KD-Tree** 進行距離比較。
   - 套用 **Ratio Test**（通常 0.7–0.8）。
   - 剔除明顯錯誤匹配。

4. **Homography 估計（手刻 DLT + RANSAC 思路）**
   - 使用至少 4 對匹配點建立線性方程組。
   - RANSAC 多次隨機抽樣，選擇最多內點的矩陣 `H_best`。

5. **影像幾何校正與反向映射（手刻）**
   - 以 `H` 將影像 B 反向映射至影像 A 的座標系。
   - 使用 **雙線性插值** 取樣，確保像素平滑。
   - 建立足夠大的畫布以容納變換後影像。

6. **融合（手刻權重/羽化）**
   - 在重疊區域使用線性權重或羽化處理，平滑接縫。

7. **裁切（手刻，可選）**
   - 偵測非空區域邊界，自動輸出乾淨拼接圖。

---

## 範例輸出過程（可放進 README 展示）

| 步驟 | 說明 | 範例圖 |
|------|------|--------|
| 1 | **找出所有關鍵點**：以 ORB/SIFT 偵測影像特徵點，顯示每張影像上的特徵分布。 | ![step1](./Matched%20Image1_2.png) |
| 2 | **保留 4 組主要對應點進行 Homography 運算**：手刻使用 DLT 方法求得轉換矩陣。 | ![step2](./matrix%20points1_2.png) |
| 3️ | **雙線性插值合併影像**：根據 Homography 將右圖反向映射並用雙線性插值填補像素。 | ![step3](./interpolation1_2.png) |
| 4️ | **刪除重疊後輸出最終結果**：清除黑邊區域並輸出完整拼接影像。 | ![step4](./delete_border_warp1_2.png) |

---


